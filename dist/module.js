/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data","emotion","lodash","@grafana/runtime","prismjs"],(function(e,t,n,r,a,o,s){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=7)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t){e.exports=o},function(e,t){e.exports=s},function(e,t,n){"use strict";n.r(t);var r=n(2),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function i(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}}function u(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return s}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}function p(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var d=n(5);function f(e){return"function"==typeof e}var h=!1,y={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;h=e},get useDeprecatedSynchronousErrorHandling(){return h}};function v(e){setTimeout((function(){throw e}),0)}var g={closed:!0,next:function(e){},error:function(e){if(y.useDeprecatedSynchronousErrorHandling)throw e;v(e)},complete:function(){}},b=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();var E=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),w=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n,r=this._parentOrParents,a=this._ctorUnsubscribe,o=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var i=0;i<r.length;++i){r[i].remove(this)}if(f(o)){a&&(this._unsubscribe=void 0);try{o.call(this)}catch(e){t=e instanceof E?S(e.errors):[e]}}if(b(s)){i=-1;for(var l=s.length;++i<l;){var u=s[i];if(null!==(n=u)&&"object"==typeof n)try{u.unsubscribe()}catch(e){t=t||[],e instanceof E?t=t.concat(S(e.errors)):t.push(e)}}}if(t)throw new E(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=n._parentOrParents;if(null===a)n._parentOrParents=this;else if(a instanceof e){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function S(e){return e.reduce((function(e,t){return e.concat(t instanceof E?t.errors:t)}),[])}var T=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),_=function(e){function t(n,r,a){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=g;break;case 1:if(!n){o.destination=g;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new x(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new x(o,n,r,a)}return o}return o(t,e),t.prototype[T]=function(){return this},t.create=function(e,n,r){var a=new t(e,n,r);return a.syncErrorThrowable=!1,a},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(w),x=function(e){function t(t,n,r,a){var o,s=e.call(this)||this;s._parentSubscriber=t;var i=s;return f(n)?o=n:n&&(o=n.next,r=n.error,a=n.complete,n!==g&&(f((i=Object.create(n)).unsubscribe)&&s.add(i.unsubscribe.bind(i)),i.unsubscribe=s.unsubscribe.bind(s))),s._context=i,s._next=o,s._error=r,s._complete=a,s}return o(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;y.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=y.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):v(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;v(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};y.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),y.useDeprecatedSynchronousErrorHandling)throw e;v(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!y.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return y.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(v(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(_);var R,N=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new O(e,this.project,this.thisArg))},e}(),O=function(e){function t(t,n,r){var a=e.call(this,t)||this;return a.project=n,a.count=0,a.thisArg=r||a,a}return o(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(_);!function(e){e.getTrace="getTrace",e.getTraceSummaries="getTraceSummaries",e.getTimeSeriesServiceStatistics="getTimeSeriesServiceStatistics",e.getAnalyticsRootCauseResponseTimeService="getAnalyticsRootCauseResponseTimeService",e.getAnalyticsRootCauseResponseTimePath="getAnalyticsRootCauseResponseTimePath",e.getAnalyticsRootCauseErrorService="getAnalyticsRootCauseErrorService",e.getAnalyticsRootCauseErrorPath="getAnalyticsRootCauseErrorPath",e.getAnalyticsRootCauseErrorMessage="getAnalyticsRootCauseErrorMessage",e.getAnalyticsRootCauseFaultService="getAnalyticsRootCauseFaultService",e.getAnalyticsRootCauseFaultPath="getAnalyticsRootCauseFaultPath",e.getAnalyticsRootCauseFaultMessage="getAnalyticsRootCauseFaultMessage",e.getAnalyticsUser="getAnalyticsUser",e.getAnalyticsUrl="getAnalyticsUrl",e.getAnalyticsStatusCode="getAnalyticsStatusCode",e.getInsights="getInsights"}(R||(R={}));var q=n(4);function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e){var t=function(e){var t=e.map((function(e){var t,n,r=[{key:"name",value:e.Document.name,type:"string"}];if(r.push.apply(r,m(function(e){var t=[];if(!e)return t;return["ec2","ecs","elastic_beanstalk","region"].forEach((function(n){e[n]&&(Object(q.isPlainObject)(e[n])?t.push.apply(t,m(P(e[n]))):t.push({key:n,value:e[n],type:"string"}))})),t}(e.Document.aws))),null===(n=null===(t=e.Document.http)||void 0===t?void 0:t.request)||void 0===n?void 0:n.url){var a=new URL(e.Document.http.request.url);r.push({key:"hostname",value:a.hostname,type:"string"})}return{serviceName:e.Document.name,tags:r}}));return Object(q.keyBy)(t,"serviceName")}(e.Segments),n=[],r=[],a=e.Segments.map((function(e){var a,o=e.Document.name;!function e(t,n){var r;(null===(r=t.subsegments)||void 0===r?void 0:r.length)&&t.subsegments.forEach((function(r){n(r,t),e(r,n)}))}(e.Document,(function(e,r){var a,s;o=null!==(s=null===(a=t[e.name])||void 0===a?void 0:a.serviceName)&&void 0!==s?s:o,n.push(A(e,o,r.id))}));var s=r.find((function(t){return t.spanID===e.Document.name+e.Document.origin}));return s||(s={duration:0,flags:1,logs:[],operationName:null!==(a=e.Document.origin)&&void 0!==a?a:e.Document.name,processID:e.Document.name,spanID:e.Document.name+e.Document.origin,startTime:1e6*e.Document.start_time,traceID:e.Document.trace_id},r.push(s)),A(e.Document,e.Document.name,s.spanID)}));return{processes:t,traceID:e.Id,spans:m(n,a,r),warnings:null}}function A(e,t,n){var r=[];return n&&r.push({refType:"CHILD_OF",spanID:n,traceID:e.trace_id}),{duration:e.end_time?1e6*e.end_time-1e6*e.start_time:0,flags:1,logs:[],operationName:e.name,processID:t,startTime:1e6*e.start_time,spanID:e.id,traceID:e.trace_id,stackTraces:k(e),tags:I(e),references:r,errorIconColor:j(e)}}function j(e){return e.error?"#FFC46E":e.throttle?"mediumpurple":void 0}function k(e){var t;if(null===(t=e.cause)||void 0===t?void 0:t.exceptions){var n=[];return e.cause.exceptions.forEach((function(e){var t,r=e.type+": "+e.message;null===(t=e.stack)||void 0===t||t.forEach((function(e){r=r.concat("\nat "+e.label+" ("+e.path+":"+e.line+")")})),n.push(r)})),n}}function I(e){var t=m(P({aws:e.aws}),P({http:e.http}),P({annotations:e.annotations}),P({metadata:e.metadata}),[{key:"in progress",value:Boolean(e.in_progress),type:"boolean"}]);return e.origin&&t.push({key:"origin",value:e.origin,type:"string"}),(e.error||e.fault||e.throttle)&&t.push({key:"error",value:!0,type:"boolean"}),t}function P(e){var t=[];if(!e)return t;var n,r=(n={},function e(t,r){Object.keys(t).forEach((function(a){var o=t[a],s=r?r+"."+a:a;if(Object(q.isPlainObject)(o)&&Object.keys(o).length)return e(o,s);Array.isArray(o)?o.forEach((function(t,r){var a=s+"["+r+"]";Object(q.isPlainObject)(t)?e(t,a):n[a]=t})):n[s]=o}))}(e,null),n);return Object.keys(r).map((function(e){var n=function(e,t,n){if(!t||Array.isArray(t)&&!t.length)return;return{key:e,type:n,value:t}}(e,r[e],C(r[e]));n&&t.push(n)})),t}var F=[{label:"ok",documentation:"Response status code was 2XX Success."},{label:"error",documentation:"Response status code was 4XX Client Error."},{label:"throttle",documentation:"Response status code was 429 Too Many Requests."},{label:"fault",documentation:"Response status code was 5XX Server Error."},{label:"partial",documentation:"Request has incomplete segments."},{label:"inferred",documentation:"Request has inferred segments."},{label:"first",documentation:"Element is the first of an enumerated list."}],U=[{label:"responsetime",documentation:"Time that the server took to send a response."},{label:"duration",documentation:"Total request duration, including all downstream calls."},{label:"http.status",documentation:"Response status code."},{label:"index",documentation:"Position of an element in an enumerated list."},{label:"coverage",documentation:"Decimal percentage of entity response time over root segment response time. Applicable only for response time root cause entities."}],L=[{label:"http.url",documentation:"Request URL."},{label:"http.method",documentation:"Request method."},{label:"http.useragent",documentation:"Request user agent string."},{label:"http.clientip",documentation:"Requestor's IP address."},{label:"user",documentation:"Value of the user field on any segment in the trace."},{label:"name",documentation:"The name of a service or exception."},{label:"type",documentation:"Service type."},{label:"message",documentation:"Exception message."},{label:"availabilityzone",documentation:"Value of the availabilityzone field on any segment in the trace."},{label:"instance.id",documentation:"Value of the instance ID field on any segment in the trace."},{label:"resource.arn",documentation:"Value of the resource ARN field on any segment in the trace."}],M=[{label:"service",documentation:"service(_name_) {_filter_}\n     Service with name _name_.\n     Optional curly braces can contain a filter expression that applies to segments created by the service."},{label:"edge",documentation:"edge(_source_, _destination_) {_filter_}\n      Connection between services _source_ and _destination_.\n      Optional curly braces can contain a filter expression that applies to segments on this connection."},{label:"annotation",documentation:"annotation.key\n    Value of an annotation with field _key_.\n    The value of an annotation can be a Boolean, number, or string, so you can use any of the comparison operators of those types.\n    You can't use this keyword in combination with the service or edge keyword."},{label:"json",documentation:"JSON root cause object.\n    See Getting data from AWS X-Ray for steps to create JSON entities programmatically."},{label:"id",documentation:'id(name: "service-name", type:"service::type")\n    You can use the id function in place of a service name in service and edge filters.'}],X=m(F,U,L,M),G={function:{pattern:new RegExp("\\b(?:"+X.map((function(e){return e.label})).join("|")+")\\b","i")},punctuation:/[{}()`,]/,whitespace:/\s+/,boolean:/\btrue|false\b/,isTraceId:/^\d-\w{8}-\w{24}$/,logicalOperator:{pattern:/\band|or\b/i,alias:"builtin"},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/},K={prefixMatch:!0,label:"Boolean Keywords",items:F},B={prefixMatch:!0,label:"Number Keywords",items:U},V={prefixMatch:!0,label:"String Keywords",items:L},J={prefixMatch:!0,label:"Complex Keywords",items:M},Q=function(e){function t(t,n){var r=e.call(this)||this;return r.request=function(){return i(r,void 0,void 0,(function(){return l(this,(function(e){return[2,Promise.resolve()]}))}))},r.start=function(){return i(r,void 0,void 0,(function(){return l(this,(function(e){return[2,[]]}))}))},r.getAllKeywords=function(){return{suggestions:[K,B,V,J]}},r.datasource=t,Object.assign(r,n),r}return o(t,e),t.prototype.provideCompletionItems=function(e){var t=e.value;return i(this,void 0,Promise,(function(){return l(this,(function(e){return t?[2,this.getAllKeywords()]:[2,{suggestions:[]}]}))}))},t}(r.LanguageProvider),H=function(e){function t(t){var n=e.call(this,t)||this;return n.languageProvider=new Q(n),n.instanceSettings=t,n}return t.$inject=["instanceSettings"],o(t,e),t.prototype.query=function(t){var n,r,a=this,o=function(e,t){return s(s({},e),{targets:e.targets.map((function(n){var r=s({},n);if(r.queryType===R.getTimeSeriesServiceStatistics&&e.intervalMs&&!r.resolution){var a=Math.floor(e.intervalMs/1e3);r.resolution=a<=60?60:300}return r.query=t.replace(r.query,e.scopedVars),n.group&&n.group.FilterExpression&&n.queryType!==R.getTrace&&(r.query?r.query=n.group.FilterExpression+" AND "+r.query:r.query=n.group.FilterExpression),r}))})}(t,Object(d.getTemplateSrv)());return e.prototype.query.call(this,o).pipe((n=function(e){return s(s({},e),{data:e.data.map((function(e){return a.parseResponse(e)}))})},function(e){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new N(n,r))}))},t.prototype.getGroups=function(){return i(this,void 0,Promise,(function(){return l(this,(function(e){return[2,this.getResource("/groups")]}))}))},t.prototype.getRegions=function(){return i(this,void 0,Promise,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return[4,this.awsRequest({queries:[{refId:"getRegions",datasourceId:this.id,type:"getRegions"}]})];case 1:return e=t.sent(),[2,m([{label:"default",value:"default",text:"default"}],this.transformSuggestDataFromTable(e))]}}))}))},t.prototype.awsRequest=function(e){return i(this,void 0,void 0,(function(){var t;return l(this,(function(n){switch(n.label){case 0:return t={method:"POST",url:"/api/tsdb/query",data:e},[4,Object(d.getBackendSrv)().datasourceRequest(t)];case 1:return[2,n.sent().data]}}))}))},t.prototype.getServiceMapUrl=function(){return this.getXrayUrl()+"#/service-map/"},t.prototype.getXrayUrlForQuery=function(e,t){var n,r=new URLSearchParams;switch(e.query&&r.append("filter",e.query),t&&r.append("timeRange",t.from.toISOString()+"~"+t.to.toISOString()),e.group&&"Default"!==e.group.GroupName&&r.append("group",e.group.GroupName),e.queryType){case R.getTraceSummaries:n="traces";break;case R.getTrace:n="traces/"+e.query,r=void 0;break;case R.getInsights:n="insights",r=void 0;break;case R.getTimeSeriesServiceStatistics:default:n="analytics"}var a=(null==r?void 0:r.toString())?"?"+(null==r?void 0:r.toString().replace(/\+/g,"%20").replace(/%3A/g,":").replace(/%7E/g,"~")):"";return this.getXrayUrl()+"#/"+n+a},t.prototype.getXrayUrl=function(){var e=this.instanceSettings.jsonData.defaultRegion;return"https://"+e+".console.aws.amazon.com/xray/home?region="+e},t.prototype.transformSuggestDataFromTable=function(e){return e.results.metricFindQuery.tables[0].rows.map((function(e){return{text:e,value:e,label:e}}))},t.prototype.parseResponse=function(e){switch(e.name){case"Traces":return function(e){var t=e.fields[0].values.get(0),n=JSON.parse(t),a=n.Segments.map((function(e){return s(s({},e),{Document:JSON.parse(e.Document)})})),o=s(s({},n),{Segments:a});return new r.MutableDataFrame({name:"Trace",fields:[{name:"trace",type:r.FieldType.trace,values:new r.ArrayVector([D(o)])}],meta:{preferredVisualisationType:"trace"}})}(e);case"TraceSummaries":return function(e,t){return e.fields.find((function(e){return e.name==="Id"})).config.links=[{title:"Trace: ${__value.raw}",url:"",internal:{datasourceUid:t,query:{query:"${__value.raw}",queryType:"getTrace"}}}],e}(e,this.instanceSettings.uid);case"InsightSummaries":return this.parseInsightsResponse(e);default:return e}},t.prototype.parseInsightsResponse=function(e){var t=this.getXrayUrl()+"#/insights/",n=e.fields.find((function(e){return"InsightId"===e.name}));n&&(n.config.links=[{title:"",url:t+"${__value.raw}",targetBlank:!0}]);var a=e.fields.find((function(e){return"Duration"===e.name}));return a&&(a.type=r.FieldType.string,a.display=function(e){return{numeric:e,text:z(Object(r.toDuration)(e))}}),e},t}(d.DataSourceWithBackend);function z(e){var t="";return e.hours()&&(t=e.hours()+" hours "),e.minutes()&&(t+=e.minutes()+" minutes "),e.seconds()&&(t+=e.seconds()+" seconds"),t}var W=n(0),$=n.n(W),Y=n(1),Z=Y.LegacyForms.Select,ee=Y.LegacyForms.Input,te=[{label:"Access & secret key",value:"keys"},{label:"Credentials file",value:"credentials"},{label:"ARN",value:"arn"}],ne=function(e){function t(t){var n=e.call(this,t)||this;return n.state={regions:re.map((function(e){return{value:e,label:e}}))},n}return o(t,e),t.prototype.render=function(){var e,t,n=this,a=this.state.regions,o=this.props.options,s=o.secureJsonData||{};return $.a.createElement($.a.Fragment,null,$.a.createElement("h3",{className:"page-heading"},"X-Ray Details"),$.a.createElement("div",{className:"gf-form-group"},$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"width-14"},"Auth Provider"),$.a.createElement(Z,{className:"width-30",value:te.find((function(e){return e.value===o.jsonData.authType})),options:te,defaultValue:o.jsonData.authType,onChange:function(e){"arn"===o.jsonData.authType&&"arn"!==e.value&&delete n.props.options.jsonData.assumeRoleArn,Object(r.onUpdateDatasourceJsonDataOptionSelect)(n.props,"authType")(e)}}))),"credentials"===o.jsonData.authType&&$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"width-14",tooltip:"Credentials profile name, as specified in ~/.aws/credentials, leave blank for default."},"Credentials Profile Name"),$.a.createElement("div",{className:"width-30"},$.a.createElement(ee,{className:"width-30",placeholder:"default",value:o.jsonData.database,onChange:Object(r.onUpdateDatasourceJsonDataOptionSelect)(this.props,"profile")})))),"keys"===o.jsonData.authType&&$.a.createElement("div",null,(null===(e=o.secureJsonFields)||void 0===e?void 0:e.accessKey)?$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"width-14"},"Access Key ID"),$.a.createElement(ee,{className:"width-25",placeholder:"Configured",disabled:!0})),$.a.createElement("div",{className:"gf-form"},$.a.createElement("div",{className:"max-width-30 gf-form-inline"},$.a.createElement(Y.Button,{variant:"secondary",type:"button",onClick:Object(r.onUpdateDatasourceResetOption)(this.props,"accessKey")},"Reset")))):$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"width-14"},"Access Key ID"),$.a.createElement("div",{className:"width-30"},$.a.createElement(ee,{className:"width-30",value:s.accessKey||"",onChange:Object(r.onUpdateDatasourceSecureJsonDataOption)(this.props,"accessKey")})))),(null===(t=o.secureJsonFields)||void 0===t?void 0:t.secretKey)?$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"width-14"},"Secret Access Key"),$.a.createElement(ee,{className:"width-25",placeholder:"Configured",disabled:!0})),$.a.createElement("div",{className:"gf-form"},$.a.createElement("div",{className:"max-width-30 gf-form-inline"},$.a.createElement(Y.Button,{variant:"secondary",type:"button",onClick:Object(r.onUpdateDatasourceResetOption)(this.props,"secretKey")},"Reset")))):$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"width-14"},"Secret Access Key"),$.a.createElement("div",{className:"width-30"},$.a.createElement(ee,{className:"width-30",value:s.secretKey||"",onChange:Object(r.onUpdateDatasourceSecureJsonDataOption)(this.props,"secretKey")}))))),"arn"===o.jsonData.authType&&$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"width-14",tooltip:"ARN of Assume Role"},"Assume Role ARN"),$.a.createElement("div",{className:"width-30"},$.a.createElement(ee,{className:"width-30",placeholder:"arn:aws:iam:*",value:o.jsonData.assumeRoleArn||"",onChange:Object(r.onUpdateDatasourceJsonDataOption)(this.props,"assumeRoleArn")})))),$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"width-14",tooltip:"Specify the region, such as for US West (Oregon) use ` us-west-2 ` as the region."},"Default Region"),$.a.createElement(Z,{className:"width-30",value:a.find((function(e){return e.value===o.jsonData.defaultRegion})),options:a,defaultValue:o.jsonData.defaultRegion,onChange:Object(r.onUpdateDatasourceJsonDataOptionSelect)(this.props,"defaultRegion")})))))},t}(W.PureComponent),re=["ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","cn-north-1","cn-northwest-1","eu-central-1","eu-north-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-iso-east-1","us-isob-east-1","us-west-1","us-west-2"];var ae={label:"Trace List",value:"traceList"},oe={label:"Insights",value:"insights",queryType:R.getInsights},se={label:"Trace Statistics",value:"traceStatistics",queryType:R.getTimeSeriesServiceStatistics},ie=[ae,se,oe,{label:"Trace Analytics",value:"traceAnalytics",children:[{value:"rootCause",label:"Root Cause",children:[{value:"responseTime",label:"Response Time",children:[{value:"rootCauseService",label:"Root Cause",queryType:R.getAnalyticsRootCauseResponseTimeService},{value:"path",label:"Path",queryType:R.getAnalyticsRootCauseResponseTimePath}]},{value:"error",label:"Error",children:[{value:"rootCauseService",label:"Root Cause",queryType:R.getAnalyticsRootCauseErrorService},{value:"path",label:"Path",queryType:R.getAnalyticsRootCauseErrorPath},{value:"message",label:"Error Message",queryType:R.getAnalyticsRootCauseErrorMessage}]},{value:"fault",label:"Fault",children:[{value:"rootCauseService",label:"Root Cause",queryType:R.getAnalyticsRootCauseFaultService},{value:"path",label:"Path",queryType:R.getAnalyticsRootCauseFaultPath},{value:"message",label:"Error Message",queryType:R.getAnalyticsRootCauseFaultMessage}]}]},{value:"user",label:"End user impact",queryType:R.getAnalyticsUser},{value:"url",label:"URL",queryType:R.getAnalyticsUrl},{value:"statusCode",label:"HTTP status code",queryType:R.getAnalyticsStatusCode}]}],le={"ErrorStatistics.ThrottleCount":"Throttle Count","ErrorStatistics.TotalCount":"Error Count","FaultStatistics.TotalCount":"Fault Count",OkCount:"Success Count",TotalCount:"Total Count","Computed.AverageResponseTime":"Average Response Time"},ue={GroupName:"All",GroupARN:"All"};var ce=n(6),me=n.n(ce),pe=[Object(Y.BracesPlugin)(),Object(Y.SlatePrism)({onlyIn:function(e){return"block"===e.object&&"code_block"===e.type},getSyntax:function(){return"xray"}})];function de(e){var t=this,n=Object(W.useRef)(e.query.queryType);Object(W.useEffect)((function(){n.current=e.query.queryType}),[e.query,e.query.queryType]),Object(W.useEffect)((function(){me.a.languages.xray=G}),[]);return $.a.createElement(Y.QueryField,{additionalPlugins:pe,query:e.query.query,portalOrigin:"xray",onChange:function(t){var n=e.query;(0,e.onChange)(s(s({},n),{query:t}))},onTypeahead:function(r){return i(t,void 0,Promise,(function(){var t;return l(this,(function(a){switch(a.label){case 0:return(t=e.datasource).languageProvider&&n.current!==R.getTrace?[4,t.languageProvider.provideCompletionItems(r)]:[2,{suggestions:[]}];case 1:return[2,a.sent()]}}))}))},placeholder:"Enter service name, annotation, trace ID.",onRunQuery:e.onRunQuery})}var fe,he=n(3),ye=Object(Y.stylesFactory)((function(){return{tooltipLink:Object(he.css)(fe||(fe=p(["\n    color: #33a2e5;\n    &:hover {\n      color: #33a2e5;\n      filter: brightness(120%);\n    }\n  "],["\n    color: #33a2e5;\n    &:hover {\n      color: #33a2e5;\n      filter: brightness(120%);\n    }\n  "])))}}));function ve(e){var t=e.datasource,n=e.query,r=e.onRunQuery,a=e.onChange,o=e.selectedOptions,i=ye();return $.a.createElement("div",{style:{flex:1,display:"flex"}},$.a.createElement(Y.InlineFormLabel,{className:"query-keyword",width:"auto"},"Query ",$.a.createElement(Y.Tooltip,{placement:"top",content:$.a.createElement("span",null,"See"," ",$.a.createElement("a",{href:"https://docs.aws.amazon.com/xray/latest/devguide/xray-console-filters.html?icmpid=docs_xray_console",target:"_blank",className:i.tooltipLink},"X-Ray documentation")," ","for filter expression help."),theme:"info"},$.a.createElement(Y.Icon,{className:"gf-form-help-icon gf-form-help-icon--right-normal",name:"info-circle",size:"sm"}))),$.a.createElement(de,{query:n,history:[],datasource:t,onRunQuery:function(){a(n),n.query&&r()},onChange:function(e){a(s(s({},n),{queryType:Te(o.map((function(e){return e.value})),e.query),query:e.query}))}}))}var ge,be,Ee=Object(Y.stylesFactory)((function(){return{container:Object(he.css)(ge||(ge=p(["\n    display: flex;\n  "],["\n    display: flex;\n  "]))),link:Object(he.css)(be||(be=p(["\n    white-space: nowrap;\n  "],["\n    white-space: nowrap;\n  "])))}}));function we(e){var t=e.datasource,n=e.query,r=e.range,a=Ee();return $.a.createElement("div",{className:a.container},[["To X-Ray service map",t.getServiceMapUrl()],["Open in X-Ray console",t.getXrayUrlForQuery(n,r)]].map((function(e){var t=c(e,2),n=t[0],r=t[1];return $.a.createElement("a",{href:r,target:"_blank",rel:"noopener",key:r},$.a.createElement("span",{className:"gf-form-label gf-form-label--btn "+a.link},$.a.createElement("i",{className:"fa fa-share-square-o"})," ",n))})))}function Se(e){return e&&e!==R.getTimeSeriesServiceStatistics?e===R.getTrace||e===R.getTraceSummaries?[ae]:e===R.getInsights?[oe]:function e(t,n){var r,a;void 0===n&&(n=ie);try{for(var o=u(n),s=o.next();!s.done;s=o.next()){var i=s.value,l=[];if(i.queryType===t)return l.push(i),l;if(i.children){var c=e(t,i.children);if(c.length)return l.push.apply(l,m([i],c)),l}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return[]}(e):[se]}function Te(e,t){var n,r,a;if(e[0]===ae.value)return/^\d-\w{8}-\w{24}$/.test(t.trim())?R.getTrace:R.getTraceSummaries;var o=void 0,s=function(e){o=(null!==(a=null==o?void 0:o.children)&&void 0!==a?a:ie).find((function(t){return t.value===e}))};try{for(var i=u(e),l=i.next();!l.done;l=i.next()){s(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o.queryType}var _e,xe,Re,Ne=Object(Y.stylesFactory)((function(){return{queryParamsRow:Object(he.css)(_e||(_e=p(["\n    flex-wrap: wrap;\n  "],["\n    flex-wrap: wrap;\n  "]))),spring:Object(he.css)(xe||(xe=p(["\n    flex: 1;\n  "],["\n    flex: 1;\n  "])))}}));function Oe(e){var t,n,r=e.query,a=e.onChange,o=e.datasource,i=e.onRunQuery,l=e.groups,u=e.range,c=Se(r.queryType);!function(e,t,n,r){Object(W.useEffect)((function(){var r,a,o=n.find((function(e){return"Default"===e.GroupName}))||n[0];if(e.queryType){var i=e.group,l=n;e.queryType===R.getInsights&&(l=m([ue],n));var u=l.find((function(t){var n;return t.GroupARN===(null===(n=e.group)||void 0===n?void 0:n.GroupARN)}));u?u.GroupName===(null===(r=e.group)||void 0===r?void 0:r.GroupName)&&u.FilterExpression===(null===(a=e.group)||void 0===a?void 0:a.FilterExpression)||(i=u):i=o,i!==e.group&&t(s(s({},e),{group:i}))}else t(s(s({},e),{queryType:R.getTraceSummaries,query:"",group:o}))}),[e,n,t,r])}(r,a,l,o);var p=c[0]===oe?m([ue],l):l,d=Ne();return $.a.createElement("div",null,c[0]!==oe&&$.a.createElement("div",{className:"gf-form"},$.a.createElement(ve,{query:r,datasource:o,onChange:a,onRunQuery:i,selectedOptions:c})),$.a.createElement("div",{className:"gf-form "+d.queryParamsRow},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"query-keyword",width:"auto"},"Query Type"),$.a.createElement(Y.ButtonCascader,{value:c.map((function(e){return e.value})),options:ie,onChange:function(e){var t=Te(e,r.query||"");a(s(s({},r),{queryType:t,columns:t===R.getTimeSeriesServiceStatistics?["all"]:void 0}))}},c[c.length-1].label)),$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"query-keyword",width:"auto"},"Group"),$.a.createElement(Y.Segment,{value:null===(t=r.group)||void 0===t?void 0:t.GroupName,options:p.map((function(e){return{value:e.GroupARN,label:e.GroupName}})),onChange:function(e){a(s(s({},r),{group:p.find((function(t){return t.GroupARN===e.value}))}))}})),$.a.createElement("div",{className:"gf-form"},c[0]===oe&&$.a.createElement("div",{className:"gf-form"},$.a.createElement(Y.InlineFormLabel,{className:"query-keyword",width:"auto"},"State"),$.a.createElement(Y.Segment,{value:null!==(n=r.state)&&void 0!==n?n:"All",options:["All","Active","Closed"].map((function(e){return{value:e,label:e}})),onChange:function(e){a(s(s({},r),{state:e.value}))}}))),$.a.createElement("div",{className:"gf-form"},c[0]===se&&$.a.createElement("div",{className:"gf-form","data-testid":"resolution",style:{flexWrap:"wrap"}},$.a.createElement(Y.InlineFormLabel,{className:"query-keyword",width:"auto"},"Resolution"),$.a.createElement(Y.Segment,{value:r.resolution?r.resolution.toString()+"s":"auto",options:["auto","60s","300s"].map((function(e){return{value:e,label:e}})),onChange:function(e){var t=e.value;a(s(s({},r),{resolution:"auto"===t?void 0:parseInt(t,10)}))}}))),$.a.createElement("div",{className:d.spring}),$.a.createElement(we,{datasource:o,query:r,range:u})),c[0]===se&&$.a.createElement("div",{className:"gf-form","data-testid":"column-filter",style:{flexWrap:"wrap"}},$.a.createElement(Y.InlineFormLabel,{className:"query-keyword",width:"auto"},"Columns"),$.a.createElement("div",{style:{flex:1}},$.a.createElement(Y.MultiSelect,{allowCustomValue:!1,options:Object.keys(le).map((function(e){return{label:le[e],value:e}})),value:(r.columns||[]).map((function(e){return{label:le[e],value:e}})),onChange:function(e){return a(s(s({},r),{columns:e.map((function(e){return e.value}))}))},closeMenuOnSelect:!1,isClearable:!0,placeholder:"All columns",menuPlacement:"bottom"}))))}function qe(e,t){return $.a.createElement("div",{className:"cheat-sheet-item__example",key:e,onClick:function(){return t({refId:"A",query:e,queryType:R.getTraceSummaries})}},$.a.createElement("code",null,e))}n.d(t,"plugin",(function(){return Ce}));var Ce=new r.DataSourcePlugin(H).setConfigEditor(ne).setExploreStartPage((function(e){var t=e.onClickExample;return $.a.createElement("div",null,$.a.createElement("h2",null,"X-Ray Cheat Sheet"),$.a.createElement("div",{className:"cheat-sheet-item"},$.a.createElement("p",null,$.a.createElement("span",null,"Use the search bar to display traces for a service, trace ID, or filter expression."),$.a.createElement("a",{target:"_blank",href:"https://docs.aws.amazon.com/console/xray/xray-filter-expressions"},"Learn more")),$.a.createElement("div",{className:"cheat-sheet-item__title"},"Filter expressions"),$.a.createElement("div",null,"You can use custom expressions to narrow down your search."),$.a.createElement("div",null,"Traces where response time was more than 5 seconds:"),qe("responsetime > 5",t),$.a.createElement("div",null,"Traces where the total duration was 5 to 8 seconds:"),$.a.createElement("div",null,qe("duration > 5 AND duration < 8",t)),$.a.createElement("div",null,"Traces that included a call to 'api.example.com' with a fault (500 series error) or response time above 2.5 seconds, and with one or more segments having an annotation named 'account' with value '12345':"),$.a.createElement("div",null,qe('service("api.example.com") AND annotation.account = "12345"',t)),$.a.createElement("div",null,"Traces where the service 'api.example.com' made a call to 'backend.example.com' that failed with a fault:"),$.a.createElement("div",null,qe('edge("api.example.com", "backend.example.com")',t)),$.a.createElement("div",null,"Traces where the URL begins with 'http://api.example.com/' and contains '/v2/' but does not reach a service named 'api.example.com':"),$.a.createElement("div",null,qe('http.url BEGINSWITH "http://api.example.com/" AND http.url CONTAINS "/v2/" AND !service("api.example.com")',t)),$.a.createElement("div",null,"Traces that completed successfully in under 3 seconds, including all downstream calls:"),$.a.createElement("div",null,qe("ok !partial duration < 3",t)),$.a.createElement("div",null,"If you have multiple services with the same name but different types, you can use an ID function to distinguish between them in a service or edge filter expression:"),$.a.createElement("div",null,qe('service(id(name: "api.example.com", type: "AWS::EC2::Instance"))',t)),$.a.createElement("div",{className:"cheat-sheet-item"},$.a.createElement("div",{className:"cheat-sheet-item__title"},"Filter keywords"),$.a.createElement("table",{className:Object(he.css)(Re||(Re=p(["\n              td {\n                padding: 5px 10px 5px 10px;\n              }\n            "],["\n              td {\n                padding: 5px 10px 5px 10px;\n              }\n            "])))},$.a.createElement("thead",null,$.a.createElement("tr",null,$.a.createElement("th",null,"Attribute"),$.a.createElement("th",null,"Type"),$.a.createElement("th",null,"Description"))),$.a.createElement("tbody",null,$.a.createElement("tr",null,$.a.createElement("td",null,"ok"),$.a.createElement("td",null,"Boolean"),$.a.createElement("td",null,"Response status code was 2XX Success.")),$.a.createElement("tr",null,$.a.createElement("td",null,"error"),$.a.createElement("td",null,"Boolean"),$.a.createElement("td",null,"Response status code was 4XX Client Error.")),$.a.createElement("tr",null,$.a.createElement("td",null,"fault"),$.a.createElement("td",null,"Boolean"),$.a.createElement("td",null,"Response status code was 5XX Server Error.")),$.a.createElement("tr",null,$.a.createElement("td",null,"partial"),$.a.createElement("td",null,"Boolean"),$.a.createElement("td",null,"Request has incomplete segments.")),$.a.createElement("tr",null,$.a.createElement("td",null,"responsetime"),$.a.createElement("td",null,"Number"),$.a.createElement("td",null,"Time that the server took to send a response.")),$.a.createElement("tr",null,$.a.createElement("td",null,"duration"),$.a.createElement("td",null,"Number"),$.a.createElement("td",null,"Total request duration including all downstream calls.")),$.a.createElement("tr",null,$.a.createElement("td",null,"http.status"),$.a.createElement("td",null,"Number"),$.a.createElement("td",null,"Response status code.")),$.a.createElement("tr",null,$.a.createElement("td",null,"http.url"),$.a.createElement("td",null,"String"),$.a.createElement("td",null,"Request URL.")),$.a.createElement("tr",null,$.a.createElement("td",null,"http.method"),$.a.createElement("td",null,"String"),$.a.createElement("td",null,"Request method.")),$.a.createElement("tr",null,$.a.createElement("td",null,"http.useragent"),$.a.createElement("td",null,"String"),$.a.createElement("td",null,"Request user agent string.")),$.a.createElement("tr",null,$.a.createElement("td",null,"http.clientip"),$.a.createElement("td",null,"String"),$.a.createElement("td",null,"Requestor's IP address.")),$.a.createElement("tr",null,$.a.createElement("td",null,"user"),$.a.createElement("td",null,"String"),$.a.createElement("td",null,"Value of user field on any segment in the trace.")),$.a.createElement("tr",null,$.a.createElement("td",null,"annotation.*key*"),$.a.createElement("td",null,"String"),$.a.createElement("td",null,"Value of annotation with field *key*.")),$.a.createElement("tr",null,$.a.createElement("td",null,"service(*name*) "),$.a.createElement("td",null,"Complex"),$.a.createElement("td",null,"Service with name *name*. Optional curly braces can contain a filter expression that applies to segments created by the service.")),$.a.createElement("tr",null,$.a.createElement("td",null,"edge(*source*, *destination*) "),$.a.createElement("td",null,"Complex"),$.a.createElement("td",null,"Connection between services *source* and *destination*. Optional curly braces can contain a filter expression that applies to segments on this connection.")))))))})).setQueryEditor((function(e){var t=function(e){var t=c(Object(W.useState)(void 0),2),n=t[0],r=t[1];return Object(W.useEffect)((function(){r(void 0),e.getGroups().then((function(e){r(e)}))}),[e]),n}(e.datasource);return t?$.a.createElement(Oe,s({},s(s({},e),{groups:t}))):$.a.createElement(Y.Spinner,null)}))}])}));
//# sourceMappingURL=module.js.map