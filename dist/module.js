/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/data","@grafana/ui","emotion","lodash","@grafana/runtime","app/core/app_events","prismjs"],(function(e,t,n,r,a,o,i,s){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=12)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),a=n(0),o=r.__importDefault(n(10));t.default=function(e,t){void 0===t&&(t=[]);var n=o.default(e,t,{loading:!0}),r=n[0],i=n[1];return a.useEffect((function(){i()}),[i]),r}},function(e,t){e.exports=o},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return a})),n.d(t,"__assign",(function(){return o})),n.d(t,"__rest",(function(){return i})),n.d(t,"__decorate",(function(){return s})),n.d(t,"__param",(function(){return l})),n.d(t,"__metadata",(function(){return u})),n.d(t,"__awaiter",(function(){return c})),n.d(t,"__generator",(function(){return d})),n.d(t,"__createBinding",(function(){return f})),n.d(t,"__exportStar",(function(){return p})),n.d(t,"__values",(function(){return m})),n.d(t,"__read",(function(){return y})),n.d(t,"__spread",(function(){return h})),n.d(t,"__spreadArrays",(function(){return v})),n.d(t,"__await",(function(){return g})),n.d(t,"__asyncGenerator",(function(){return b})),n.d(t,"__asyncDelegator",(function(){return E})),n.d(t,"__asyncValues",(function(){return w})),n.d(t,"__makeTemplateObject",(function(){return S})),n.d(t,"__importStar",(function(){return T})),n.d(t,"__importDefault",(function(){return N})),n.d(t,"__classPrivateFieldGet",(function(){return x})),n.d(t,"__classPrivateFieldSet",(function(){return O}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function a(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}function s(e,t,n,r){var a,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i}function l(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var f=Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function p(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||f(t,e,n)}function m(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function v(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r}function g(e){return this instanceof g?(this.v=e,this):new g(e)}function b(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=a[e](t)).value instanceof g?Promise.resolve(n.value.v).then(l,u):c(o[0][2],n)}catch(e){c(o[0][3],e)}var n}function l(e){s("next",e)}function u(e){s("throw",e)}function c(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function E(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,a){t[r]=e[r]?function(t){return(n=!n)?{value:g(e[r](t)),done:"return"===r}:a?a(t):t}:a}}function w(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=m(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,a,(t=e[n](t)).done,t.value)}))}}}function S(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var _=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&f(t,e,n);return _(t,e),t}function N(e){return e&&e.__esModule?e:{default:e}}function x(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function O(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}},function(e,t){e.exports=i},function(e,t){e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),a=n(0),o=r.__importDefault(n(11));t.default=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var i=a.useRef(0),s=o.default(),l=a.useState(n),u=l[0],c=l[1];return[u,a.useCallback((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var a=++i.current;return c((function(e){return r.__assign(r.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return s()&&a===i.current&&c({value:e,loading:!1}),e}),(function(e){return s()&&a===i.current&&c({error:e,loading:!1}),e}))}),t)]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(){var e=r.useRef(!1),t=r.useCallback((function(){return e.current}),[]);return r.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},function(e,t,n){"use strict";n.r(t);var r=n(1),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function s(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function u(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}function f(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var p=n(4),m=n(6);function y(e){return"function"==typeof e}var h=!1,v={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e);h=e},get useDeprecatedSynchronousErrorHandling(){return h}};function g(e){setTimeout((function(){throw e}),0)}var b={closed:!0,next:function(e){},error:function(e){if(v.useDeprecatedSynchronousErrorHandling)throw e;g(e)},complete:function(){}},E=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();var w=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),S=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n,r=this._parentOrParents,a=this._ctorUnsubscribe,o=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var s=0;s<r.length;++s){r[s].remove(this)}if(y(o)){a&&(this._unsubscribe=void 0);try{o.call(this)}catch(e){t=e instanceof w?_(e.errors):[e]}}if(E(i)){s=-1;for(var l=i.length;++s<l;){var u=i[s];if(null!==(n=u)&&"object"==typeof n)try{u.unsubscribe()}catch(e){t=t||[],e instanceof w?t=t.concat(_(e.errors)):t.push(e)}}}if(t)throw new w(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=n._parentOrParents;if(null===a)n._parentOrParents=this;else if(a instanceof e){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function _(e){return e.reduce((function(e,t){return e.concat(t instanceof w?t.errors:t)}),[])}var T=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),N=function(e){function t(n,r,a){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=b;break;case 1:if(!n){o.destination=b;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new x(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new x(o,n,r,a)}return o}return o(t,e),t.prototype[T]=function(){return this},t.create=function(e,n,r){var a=new t(e,n,r);return a.syncErrorThrowable=!1,a},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(S),x=function(e){function t(t,n,r,a){var o,i=e.call(this)||this;i._parentSubscriber=t;var s=i;return y(n)?o=n:n&&(o=n.next,r=n.error,a=n.complete,n!==b&&(y((s=Object.create(n)).unsubscribe)&&i.add(s.unsubscribe.bind(s)),s.unsubscribe=i.unsubscribe.bind(i))),i._context=s,i._next=o,i._error=r,i._complete=a,i}return o(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;v.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=v.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):g(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;g(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};v.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),v.useDeprecatedSynchronousErrorHandling)throw e;g(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return v.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(g(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(N);var O,R=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new C(e,this.project,this.thisArg))},e}(),C=function(e){function t(t,n,r){var a=e.call(this,t)||this;return a.project=n,a.count=0,a.thisArg=r||a,a}return o(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(N);!function(e){e.getTrace="getTrace",e.getTraceSummaries="getTraceSummaries",e.getTimeSeriesServiceStatistics="getTimeSeriesServiceStatistics",e.getAnalyticsRootCauseResponseTimeService="getAnalyticsRootCauseResponseTimeService",e.getAnalyticsRootCauseResponseTimePath="getAnalyticsRootCauseResponseTimePath",e.getAnalyticsRootCauseErrorService="getAnalyticsRootCauseErrorService",e.getAnalyticsRootCauseErrorPath="getAnalyticsRootCauseErrorPath",e.getAnalyticsRootCauseErrorMessage="getAnalyticsRootCauseErrorMessage",e.getAnalyticsRootCauseFaultService="getAnalyticsRootCauseFaultService",e.getAnalyticsRootCauseFaultPath="getAnalyticsRootCauseFaultPath",e.getAnalyticsRootCauseFaultMessage="getAnalyticsRootCauseFaultMessage",e.getAnalyticsUser="getAnalyticsUser",e.getAnalyticsUrl="getAnalyticsUrl",e.getAnalyticsStatusCode="getAnalyticsStatusCode",e.getInsights="getInsights",e.getServiceMap="getServiceMap"}(O||(O={}));var D=n(2);function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e){var t=function(e){var t=e.map((function(e){var t,n,r=[{key:"name",value:e.Document.name,type:"string"}];if(r.push.apply(r,d(function(e){var t=[];if(!e)return t;return["ec2","ecs","elastic_beanstalk","region"].forEach((function(n){e[n]&&(Object(p.isPlainObject)(e[n])?t.push.apply(t,d(k(e[n]))):t.push({key:n,value:e[n],type:"string"}))})),t}(e.Document.aws))),null===(n=null===(t=e.Document.http)||void 0===t?void 0:t.request)||void 0===n?void 0:n.url){var a=new URL(e.Document.http.request.url);r.push({key:"hostname",value:a.hostname,type:"string"})}return{serviceName:e.Document.name,tags:r}}));return Object(p.keyBy)(t,"serviceName")}(e.Segments),n=[],r=[],a=e.Segments.map((function(e){var a,o=e.Document.name;!function e(t,n){var r;(null===(r=t.subsegments)||void 0===r?void 0:r.length)&&t.subsegments.forEach((function(r){n(r,t),e(r,n)}))}(e.Document,(function(e,r){var a,i;o=null!==(i=null===(a=t[e.name])||void 0===a?void 0:a.serviceName)&&void 0!==i?i:o,n.push(j(e,o,r.id))}));var i=r.find((function(t){return t.spanID===e.Document.name+e.Document.origin}));return i||(i={duration:0,flags:1,logs:[],operationName:null!==(a=e.Document.origin)&&void 0!==a?a:e.Document.name,processID:e.Document.name,spanID:e.Document.name+e.Document.origin,startTime:1e6*e.Document.start_time,traceID:e.Document.trace_id},r.push(i)),j(e.Document,e.Document.name,i.spanID)}));return{processes:t,traceID:e.Id,spans:d(n,a,r),warnings:null}}function j(e,t,n){var r=[];return n&&r.push({refType:"CHILD_OF",spanID:n,traceID:e.trace_id}),{duration:e.end_time?1e6*e.end_time-1e6*e.start_time:0,flags:1,logs:[],operationName:e.name,processID:t,startTime:1e6*e.start_time,spanID:e.id,traceID:e.trace_id,stackTraces:I(e),tags:P(e),references:r,errorIconColor:q(e)}}function q(e){return e.error?"#FFC46E":e.throttle?"mediumpurple":void 0}function I(e){var t;if(null===(t=e.cause)||void 0===t?void 0:t.exceptions){var n=[];return e.cause.exceptions.forEach((function(e){var t,r=e.type+": "+e.message;null===(t=e.stack)||void 0===t||t.forEach((function(e){r=r.concat("\nat "+e.label+" ("+e.path+":"+e.line+")")})),n.push(r)})),n}}function P(e){var t=d(k({aws:e.aws}),k({http:e.http}),k({annotations:e.annotations}),k({metadata:e.metadata}),[{key:"in progress",value:Boolean(e.in_progress),type:"boolean"}]);return e.origin&&t.push({key:"origin",value:e.origin,type:"string"}),(e.error||e.fault||e.throttle)&&t.push({key:"error",value:!0,type:"boolean"}),t}function k(e){var t=[];if(!e)return t;var n,r=(n={},function e(t,r){Object.keys(t).forEach((function(a){var o=t[a],i=r?r+"."+a:a;if(Object(p.isPlainObject)(o)&&Object.keys(o).length)return e(o,i);Array.isArray(o)?o.forEach((function(t,r){var a=i+"["+r+"]";Object(p.isPlainObject)(t)?e(t,a):n[a]=t})):n[i]=o}))}(e,null),n);return Object.keys(r).map((function(e){var n=function(e,t,n){if(!t||Array.isArray(t)&&!t.length)return;return{key:e,type:n,value:t}}(e,r[e],F(r[e]));n&&t.push(n)})),t}function M(e,t,n){var a,o,i,s,l,c=e.fields[0].values.toArray().map((function(e){return JSON.parse(e)})),f=null!==(l=null==n?void 0:n.showRequestCounts)&&void 0!==l&&l,p={name:D.NodeGraphDataFrameFieldNames.id,type:r.FieldType.string,values:new r.ArrayVector},m={name:D.NodeGraphDataFrameFieldNames.title,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Name"}},y={name:D.NodeGraphDataFrameFieldNames.subTitle,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Type"}},h={name:D.NodeGraphDataFrameFieldNames.mainStat,type:r.FieldType.number,values:new r.ArrayVector,config:{unit:"ms/t",displayName:"Average response time"}},v=f?{name:D.NodeGraphDataFrameFieldNames.secondaryStat,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Requests count"}}:{name:D.NodeGraphDataFrameFieldNames.secondaryStat,type:r.FieldType.number,values:new r.ArrayVector,config:{unit:"t/min",displayName:"Transactions per minute"}},g={name:D.NodeGraphDataFrameFieldNames.arc+"success",type:r.FieldType.number,values:new r.ArrayVector,config:{color:{fixedColor:"green",mode:r.FieldColorModeId.Fixed}}},b={name:D.NodeGraphDataFrameFieldNames.arc+"errors",type:r.FieldType.number,values:new r.ArrayVector,config:{color:{fixedColor:"semi-dark-yellow",mode:r.FieldColorModeId.Fixed}}},E={name:D.NodeGraphDataFrameFieldNames.arc+"faults",type:r.FieldType.number,values:new r.ArrayVector,config:{color:{fixedColor:"red",mode:r.FieldColorModeId.Fixed}}},w={name:D.NodeGraphDataFrameFieldNames.arc+"throttled",type:r.FieldType.number,values:new r.ArrayVector,config:{color:{fixedColor:"purple",mode:r.FieldColorModeId.Fixed}}},S={name:D.NodeGraphDataFrameFieldNames.id,type:r.FieldType.string,values:new r.ArrayVector},_={name:D.NodeGraphDataFrameFieldNames.source,type:r.FieldType.string,values:new r.ArrayVector},T={name:D.NodeGraphDataFrameFieldNames.target,type:r.FieldType.string,values:new r.ArrayVector},N={name:"sourceName",type:r.FieldType.string,values:new r.ArrayVector},x={name:"targetName",type:r.FieldType.string,values:new r.ArrayVector},O={name:D.NodeGraphDataFrameFieldNames.mainStat,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Response percentage"}},R=f?{name:D.NodeGraphDataFrameFieldNames.secondaryStat,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Requests count"}}:{name:D.NodeGraphDataFrameFieldNames.secondaryStat,type:r.FieldType.number,values:new r.ArrayVector,config:{unit:"t/min",displayName:"Transactions per minute"}},C={},F=[],A=function(e){var t,n=e.SummaryStatistics?e:e.Edges[0],r=n.SummaryStatistics;if(p.values.add(e.ReferenceId),m.values.add(e.Name),y.values.add(e.Type),h.values.add((t=r).TotalResponseTime/t.TotalCount*1e3),f){var a=n.ResponseTimeHistogram.reduce((function(e,t){return e+t.Count}),0);v.values.add(a+" Request"+(a>1?"s":""))}else v.values.add(e.SummaryStatistics?G(r,e.StartTime,e.EndTime):G(r,e.Edges[0].StartTime,e.Edges[0].EndTime));g.values.add(U(r)),b.values.add(L(r)),E.values.add(K(r)),w.values.add(V(r)),C[e.ReferenceId]=e,F.push.apply(F,d(e.Edges.map((function(t){return{edge:t,source:e}}))))};try{for(var j=u(c),q=j.next();!q.done;q=j.next()){A(q.value)}}catch(e){a={error:e}}finally{try{q&&!q.done&&(o=j.return)&&o.call(j)}finally{if(a)throw a.error}}try{for(var I=u(F),P=I.next();!P.done;P=I.next()){var k=P.value,M=k.edge,X=k.source,B=C[M.ReferenceId];S.values.add(X.ReferenceId+"__"+B.ReferenceId),_.values.add(X.ReferenceId),T.values.add(M.ReferenceId),N.values.add(X.Name),x.values.add(B.Name);var H=M.SummaryStatistics,J=U(M.SummaryStatistics);if(1===J)O.values.add("Success "+(100*J).toFixed(2)+"%");else{var Q=[[K(H),"Faults"],[L(H),"Errors"],[V(H),"Throttled"]].find((function(e){return 0!==e[0]}));Q?O.values.add(Q[1]+" "+(100*Q[0]).toFixed(2)+"%"):O.values.add("N/A")}if(f){var W=M.ResponseTimeHistogram.reduce((function(e,t){return e+t.Count}),0);R.values.add(W+" Request"+(W>1?"s":""))}else R.values.add(G(M.SummaryStatistics,M.StartTime,M.EndTime))}}catch(e){i={error:e}}finally{try{P&&!P.done&&(s=I.return)&&s.call(I)}finally{if(i)throw i.error}}return[new r.MutableDataFrame({name:"nodes",refId:null==t?void 0:t.refId,fields:[p,m,y,h,v,g,E,b,w],meta:{preferredVisualisationType:"nodeGraph"}}),new r.MutableDataFrame({name:"edges",refId:null==t?void 0:t.refId,fields:[S,_,N,T,x,O,R],meta:{preferredVisualisationType:"nodeGraph"}})]}function G(e,t,n){return n&&t?e.TotalCount/((X(n)-X(t))/6e4):void 0}function U(e){return e.OkCount/e.TotalCount}function V(e){return e.ErrorStatistics.ThrottleCount/e.TotalCount}function L(e){return(e.ErrorStatistics.TotalCount-e.ErrorStatistics.ThrottleCount)/e.TotalCount}function K(e){return e.FaultStatistics.TotalCount/e.TotalCount}function X(e){return"number"==typeof e?1e3*e:new Date(e).valueOf()}var B=[{label:"ok",documentation:"Response status code was 2XX Success."},{label:"error",documentation:"Response status code was 4XX Client Error."},{label:"throttle",documentation:"Response status code was 429 Too Many Requests."},{label:"fault",documentation:"Response status code was 5XX Server Error."},{label:"partial",documentation:"Request has incomplete segments."},{label:"inferred",documentation:"Request has inferred segments."},{label:"first",documentation:"Element is the first of an enumerated list."}],H=[{label:"responsetime",documentation:"Time that the server took to send a response."},{label:"duration",documentation:"Total request duration, including all downstream calls."},{label:"http.status",documentation:"Response status code."},{label:"index",documentation:"Position of an element in an enumerated list."},{label:"coverage",documentation:"Decimal percentage of entity response time over root segment response time. Applicable only for response time root cause entities."}],J=[{label:"http.url",documentation:"Request URL."},{label:"http.method",documentation:"Request method."},{label:"http.useragent",documentation:"Request user agent string."},{label:"http.clientip",documentation:"Requestor's IP address."},{label:"user",documentation:"Value of the user field on any segment in the trace."},{label:"name",documentation:"The name of a service or exception."},{label:"type",documentation:"Service type."},{label:"message",documentation:"Exception message."},{label:"availabilityzone",documentation:"Value of the availabilityzone field on any segment in the trace."},{label:"instance.id",documentation:"Value of the instance ID field on any segment in the trace."},{label:"resource.arn",documentation:"Value of the resource ARN field on any segment in the trace."}],Q=[{label:"service",documentation:"service(_name_) {_filter_}\n     Service with name _name_.\n     Optional curly braces can contain a filter expression that applies to segments created by the service."},{label:"edge",documentation:"edge(_source_, _destination_) {_filter_}\n      Connection between services _source_ and _destination_.\n      Optional curly braces can contain a filter expression that applies to segments on this connection."},{label:"annotation",documentation:"annotation.key\n    Value of an annotation with field _key_.\n    The value of an annotation can be a Boolean, number, or string, so you can use any of the comparison operators of those types.\n    You can't use this keyword in combination with the service or edge keyword."},{label:"json",documentation:"JSON root cause object.\n    See Getting data from AWS X-Ray for steps to create JSON entities programmatically."},{label:"id",documentation:'id(name: "service-name", type:"service::type")\n    You can use the id function in place of a service name in service and edge filters.'}],W=d(B,H,J,Q),$={function:{pattern:new RegExp("\\b(?:"+W.map((function(e){return e.label})).join("|")+")\\b","i")},punctuation:/[{}()`,]/,whitespace:/\s+/,boolean:/\btrue|false\b/,isTraceId:/^\d-\w{8}-\w{24}$/,logicalOperator:{pattern:/\band|or\b/i,alias:"builtin"},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/},z={prefixMatch:!0,label:"Boolean Keywords",items:B},Y={prefixMatch:!0,label:"Number Keywords",items:H},Z={prefixMatch:!0,label:"String Keywords",items:J},ee={prefixMatch:!0,label:"Complex Keywords",items:Q},te=function(e){function t(t,n){var r=e.call(this)||this;return r.request=function(){return s(r,void 0,void 0,(function(){return l(this,(function(e){return[2,Promise.resolve()]}))}))},r.start=function(){return s(r,void 0,void 0,(function(){return l(this,(function(e){return[2,[]]}))}))},r.getAllKeywords=function(){return{suggestions:[z,Y,Z,ee]}},r.datasource=t,Object.assign(r,n),r}return o(t,e),t.prototype.provideCompletionItems=function(e){var t=e.value;return s(this,void 0,Promise,(function(){return l(this,(function(e){return t?[2,this.getAllKeywords()]:[2,{suggestions:[]}]}))}))},t}(r.LanguageProvider);function ne(e,t,n){var r=function(e,t,n){return function(r,a,o){return{title:r,url:"",internal:{query:i(i({},n||{}),{queryType:a,query:e+(o?" "+o:"")}),datasourceUid:t.uid,datasourceName:t.name}}}}(e,t,n);return[r("Traces/All",O.getTraceSummaries),r("Traces/OK",O.getTraceSummaries,"{ ok = true }"),r("Traces/Errors",O.getTraceSummaries,"{ error = true }"),r("Traces/Faults",O.getTraceSummaries,"{ fault = true }"),r("Root cause/Error",O.getAnalyticsRootCauseErrorService),r("Root cause/Fault",O.getAnalyticsRootCauseFaultService),r("Root cause/Response Time",O.getAnalyticsRootCauseResponseTimeService)]}var re=function(e){function t(t){var n=e.call(this,t)||this;return n.languageProvider=new te(n),n.instanceSettings=t,n}return t.$inject=["instanceSettings"],o(t,e),t.prototype.query=function(t){var n,r,a=this,o=function(e,t){return i(i({},e),{targets:e.targets.map((function(n){var r=i({},n);if(r.queryType===O.getTimeSeriesServiceStatistics&&e.intervalMs&&!r.resolution){var a=Math.floor(e.intervalMs/1e3);r.resolution=a<=60?60:300}return r.query=t.replace(r.query,e.scopedVars),n.group&&n.group.FilterExpression&&n.queryType!==O.getTrace&&(r.query?r.query=n.group.FilterExpression+" AND "+r.query:r.query=n.group.FilterExpression),r}))})}(t,Object(m.getTemplateSrv)());return e.prototype.query.call(this,o).pipe((n=function(e){return i(i({},e),{data:e.data.flatMap((function(e){var n=t.targets.find((function(t){return t.refId===e.refId}));return a.parseResponse(e,n)}))})},function(e){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new R(n,r))}))},t.prototype.getGroups=function(e){return s(this,void 0,Promise,(function(){var t,n;return l(this,(function(r){return t="",e&&(n=new URLSearchParams({region:e}),t="?"+n.toString()),[2,this.getResource("/groups"+t)]}))}))},t.prototype.getRegions=function(){return s(this,void 0,Promise,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return[4,this.getResource("/regions")];case 1:return e=t.sent(),[2,d(Object(p.sortBy)(e.map((function(e){return{label:e.RegionName,value:e.RegionName,text:e.RegionName}})),"label"))]}}))}))},t.prototype.getServiceMapUrl=function(e){return this.getXrayUrl(e)+"#/service-map/"},t.prototype.getXrayUrlForQuery=function(e,t){var n,r=new URLSearchParams;switch(e.query&&r.append("filter",e.query),t&&r.append("timeRange",t.from.toISOString()+"~"+t.to.toISOString()),e.group&&"Default"!==e.group.GroupName&&r.append("group",e.group.GroupName),e.queryType){case O.getTraceSummaries:n="traces";break;case O.getTrace:n="traces/"+e.query,r=void 0;break;case O.getInsights:n="insights",r=void 0;break;case O.getTimeSeriesServiceStatistics:default:n="analytics"}var a=(null==r?void 0:r.toString())?"?"+(null==r?void 0:r.toString().replace(/\+/g,"%20").replace(/%3A/g,":").replace(/%7E/g,"~")):"";return this.getXrayUrl(e.region)+"#/"+n+a},t.prototype.getXrayUrl=function(e){return"https://"+(e=e&&"default"!==e?e:this.instanceSettings.jsonData.defaultRegion)+".console.aws.amazon.com/xray/home?region="+e},t.prototype.parseResponse=function(e,t){switch(e.name){case"Traces":return function(e,t){var n=e.fields[0].values.get(0),a=JSON.parse(n),o=a.Segments.map((function(e){return i(i({},e),{Document:JSON.parse(e.Document)})})),s=i(i({},a),{Segments:o});return[new r.MutableDataFrame({name:"Trace",refId:null==t?void 0:t.refId,fields:[{name:"trace",type:r.FieldType.trace,values:new r.ArrayVector([A(s)])}],meta:{preferredVisualisationType:"trace"}})]}(e,t);case"TraceSummaries":return function(e,t,n){return e.fields.find((function(e){return e.name==="Id"})).config.links=[{title:"Trace: ${__value.raw}",url:"",internal:{datasourceUid:t.uid,datasourceName:t.name,query:i(i({},n||{}),{query:"${__value.raw}",queryType:"getTrace"})}}],[e]}(e,this.instanceSettings,t);case"InsightSummaries":return this.parseInsightsResponse(e,null==t?void 0:t.region);case"ServiceMap":return function(e,t,n){var r=c(M(e,n),2),a=r[0],o=r[1];a.fields[0].config={links:ne('service(id(name: "${__data.fields.title}", type: "${__data.fields.subTitle}"))',t,n)};return o.fields[0].config={links:ne('edge("${__data.fields.sourceName}", "${__data.fields.targetName}")',t,n)},[a,o]}(e,this.instanceSettings,t);case"TraceGraph":return M(e,t,{showRequestCounts:!0});default:return[e]}},t.prototype.parseInsightsResponse=function(e,t){var n=this.getXrayUrl(t)+"#/insights/",a=e.fields.find((function(e){return"InsightId"===e.name}));a&&(a.config.links=[{title:"",url:n+"${__value.raw}",targetBlank:!0}]);var o=e.fields.find((function(e){return"Duration"===e.name}));return o&&(o.type=r.FieldType.string,o.display=function(e){return{numeric:e,text:ae(Object(r.toDuration)(e))}}),[e]},t}(m.DataSourceWithBackend);function ae(e){var t="";return e.hours()&&(t=e.hours()+" hours "),e.minutes()&&(t+=e.minutes()+" minutes "),e.seconds()&&(t+=e.seconds()+" seconds"),t}var oe,ie=n(0),se=n.n(ie);!function(e){e.Keys="keys",e.CredentialsOld="credentials",e.Credentials="sharedCreds",e.Default="default"}(oe||(oe={}));var le=[{label:"AWS SDK Default",value:oe.Default},{label:"Access & secret key",value:oe.Keys},{label:"Credentials file",value:oe.Credentials}],ue=["ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","cn-north-1","cn-northwest-1","eu-central-1","eu-north-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-iso-east-1","us-isob-east-1","us-west-1","us-west-2"].map((function(e){return{value:e,label:e}})),ce=D.LegacyForms.Select,de=D.LegacyForms.Input,fe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={regions:ue},t}return o(t,e),t.prototype.render=function(){var e,t,n,a=this,o=this.state.regions,i=this.props.options,s=i.secureJsonData||{},l=i.jsonData.profile;return void 0===l&&(l=i.database),se.a.createElement(se.a.Fragment,null,se.a.createElement("h3",{className:"page-heading"},"Connection Details"),se.a.createElement("div",{className:"gf-form-group"},se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14",tooltip:"Specify which AWS credentials chain to use. AWS SDK Default is the recommended option for EKS, ECS, or if you've attached an IAM role to your EC2 instance."},"Authentication Provider"),se.a.createElement(ce,{className:"width-30",value:le.find((function(e){return e.value===i.jsonData.authType}))||le[0],options:le,defaultValue:i.jsonData.authType,onChange:function(e){Object(r.onUpdateDatasourceJsonDataOptionSelect)(a.props,"authType")(e)}}))),(i.jsonData.authType===oe.Credentials||i.jsonData.authType===oe.CredentialsOld)&&se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14",tooltip:"Credentials profile name, as specified in ~/.aws/credentials, leave blank for default."},"Credentials Profile Name"),se.a.createElement("div",{className:"width-30"},se.a.createElement(de,{className:"width-30",placeholder:"default",value:l,onChange:Object(r.onUpdateDatasourceJsonDataOption)(this.props,"profile")})))),i.jsonData.authType===oe.Keys&&se.a.createElement("div",null,(null===(e=i.secureJsonFields)||void 0===e?void 0:e.accessKey)?se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14"},"Access Key ID"),se.a.createElement(de,{className:"width-25",placeholder:"Configured",disabled:!0})),se.a.createElement("div",{className:"gf-form"},se.a.createElement("div",{className:"max-width-30 gf-form-inline"},se.a.createElement(D.Button,{variant:"secondary",type:"button",onClick:Object(r.onUpdateDatasourceResetOption)(this.props,"accessKey")},"Reset")))):se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14"},"Access Key ID"),se.a.createElement("div",{className:"width-30"},se.a.createElement(de,{className:"width-30",value:s.accessKey||"",onChange:Object(r.onUpdateDatasourceSecureJsonDataOption)(this.props,"accessKey")})))),(null===(t=i.secureJsonFields)||void 0===t?void 0:t.secretKey)?se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14"},"Secret Access Key"),se.a.createElement(de,{className:"width-25",placeholder:"Configured",disabled:!0})),se.a.createElement("div",{className:"gf-form"},se.a.createElement("div",{className:"max-width-30 gf-form-inline"},se.a.createElement(D.Button,{variant:"secondary",type:"button",onClick:Object(r.onUpdateDatasourceResetOption)(this.props,"secretKey")},"Reset")))):se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14"},"Secret Access Key"),se.a.createElement("div",{className:"width-30"},se.a.createElement(de,{className:"width-30",value:s.secretKey||"",onChange:Object(r.onUpdateDatasourceSecureJsonDataOption)(this.props,"secretKey")}))))),se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14",tooltip:"Optionally, specify the ARN of a role to assume. Specifying a role here will ensure that the selected authentication provider is used to assume the specified role rather than using the credentials directly. Leave blank if you don't need to assume a role at all"},"Assume Role ARN"),se.a.createElement("div",{className:"width-30"},se.a.createElement(de,{className:"width-30",placeholder:"arn:aws:iam:*",value:i.jsonData.assumeRoleArn||"",onChange:Object(r.onUpdateDatasourceJsonDataOption)(this.props,"assumeRoleArn")})))),se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14",tooltip:"If you are assuming a role in another account, that has been created with an external ID, specify the external ID here."},"External ID"),se.a.createElement("div",{className:"width-30"},se.a.createElement(de,{className:"width-30",placeholder:"External ID",value:i.jsonData.externalId||"",onChange:Object(r.onUpdateDatasourceJsonDataOption)(this.props,"externalId")}))))),se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14",tooltip:"Specify the region, such as for US West (Oregon) use ` us-west-2 ` as the region."},"Default Region"),se.a.createElement(ce,{className:"width-30",value:o.find((function(e){return e.value===i.jsonData.defaultRegion})),options:o,defaultValue:i.jsonData.defaultRegion,onChange:Object(r.onUpdateDatasourceJsonDataOptionSelect)(this.props,"defaultRegion")}))),se.a.createElement("div",{className:"gf-form-inline"},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"width-14",tooltip:"Optionally, specify a custom endpoint for the service"},"Endpoint"),se.a.createElement("div",{className:"width-30"},se.a.createElement(de,{className:"width-30",placeholder:null!==(n=this.props.defaultEndpoint)&&void 0!==n?n:"https://{service}.{region}.amazonaws.com",value:i.jsonData.endpoint||"",onChange:Object(r.onUpdateDatasourceJsonDataOption)(this.props,"endpoint")}))))))},t}(ie.PureComponent),pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(){return se.a.createElement("div",null,se.a.createElement(fe,i({},this.props)))},t}(ie.PureComponent),me=n(5),ye=n.n(me),he=n(8),ve=n.n(he);function ge(e,t){Object(ie.useEffect)((function(){var n,a;t&&(ve.a.emit(r.AppEvents.alertWarning,[e,(null===(a=null===(n=t)||void 0===n?void 0:n.data)||void 0===a?void 0:a.message)||t.message]),t.isHandled=!0)}),[t,e])}var be={label:"Trace List",value:"traceList"},Ee={label:"Insights",value:"insights",queryType:O.getInsights},we={label:"Service Map",value:"serviceMap",queryType:O.getServiceMap},Se={label:"Trace Statistics",value:"traceStatistics",queryType:O.getTimeSeriesServiceStatistics},_e=[be,Se,Ee,{label:"Trace Analytics",value:"traceAnalytics",children:[{value:"rootCause",label:"Root Cause",children:[{value:"responseTime",label:"Response Time",children:[{value:"rootCauseService",label:"Root Cause",queryType:O.getAnalyticsRootCauseResponseTimeService},{value:"path",label:"Path",queryType:O.getAnalyticsRootCauseResponseTimePath}]},{value:"error",label:"Error",children:[{value:"rootCauseService",label:"Root Cause",queryType:O.getAnalyticsRootCauseErrorService},{value:"path",label:"Path",queryType:O.getAnalyticsRootCauseErrorPath},{value:"message",label:"Error Message",queryType:O.getAnalyticsRootCauseErrorMessage}]},{value:"fault",label:"Fault",children:[{value:"rootCauseService",label:"Root Cause",queryType:O.getAnalyticsRootCauseFaultService},{value:"path",label:"Path",queryType:O.getAnalyticsRootCauseFaultPath},{value:"message",label:"Error Message",queryType:O.getAnalyticsRootCauseFaultMessage}]}]},{value:"user",label:"End user impact",queryType:O.getAnalyticsUser},{value:"url",label:"URL",queryType:O.getAnalyticsUrl},{value:"statusCode",label:"HTTP status code",queryType:O.getAnalyticsStatusCode}]},we],Te={"ErrorStatistics.ThrottleCount":"Throttle Count","ErrorStatistics.TotalCount":"Error Count","FaultStatistics.TotalCount":"Fault Count",OkCount:"Success Count",TotalCount:"Total Count","Computed.AverageResponseTime":"Average Response Time"},Ne={GroupName:"All",GroupARN:"All"};function xe(e,t,n,r,a){Object(ie.useEffect)((function(){var a=n.find((function(e){return"Default"===e.GroupName}))||n[0];if(e.queryType){var o=function(e,t,n){var r,a,o=e.group,i=t;e.queryType===O.getInsights&&(i=d([Ne],t));var s=i.find((function(t){var n;return t.GroupARN===(null===(n=e.group)||void 0===n?void 0:n.GroupARN)}));s?s.GroupName===(null===(r=e.group)||void 0===r?void 0:r.GroupName)&&s.FilterExpression===(null===(a=e.group)||void 0===a?void 0:a.FilterExpression)||(o=s):o=n;return o}(e,n,a),s=function(e,t){if(e.region){var n=t.find((function(t){return t.value===e.region}));if(n)return n.value}return"default"}(e,r);o===e.group&&s===e.region||t(i(i({},e),{group:o,region:s}))}else t(i(i({},e),{queryType:O.getTraceSummaries,query:"",group:a,region:"default"}))}),[e,n,r,t,a])}var Oe=n(9),Re=n.n(Oe),Ce=[Object(D.BracesPlugin)(),Object(D.SlatePrism)({onlyIn:function(e){return"block"===e.object&&"code_block"===e.type},getSyntax:function(){return"xray"}})];function De(e){var t=this,n=Object(ie.useRef)(e.query.queryType);Object(ie.useEffect)((function(){n.current=e.query.queryType}),[e.query,e.query.queryType]),Object(ie.useEffect)((function(){Re.a.languages.xray=$}),[]);return se.a.createElement(D.QueryField,{additionalPlugins:Ce,query:e.query.query,portalOrigin:"xray",onChange:function(t){var n=e.query;(0,e.onChange)(i(i({},n),{query:t}))},onTypeahead:function(r){return s(t,void 0,Promise,(function(){var t;return l(this,(function(a){switch(a.label){case 0:return(t=e.datasource).languageProvider&&n.current!==O.getTrace?[4,t.languageProvider.provideCompletionItems(r)]:[2,{suggestions:[]}];case 1:return[2,a.sent()]}}))}))},placeholder:"Enter service name, annotation, trace ID.",onRunQuery:e.onRunQuery})}var Fe,Ae=n(3),je=Object(D.stylesFactory)((function(){return{tooltipLink:Object(Ae.css)(Fe||(Fe=f(["\n    color: #33a2e5;\n    &:hover {\n      color: #33a2e5;\n      filter: brightness(120%);\n    }\n  "],["\n    color: #33a2e5;\n    &:hover {\n      color: #33a2e5;\n      filter: brightness(120%);\n    }\n  "])))}}));function qe(e){var t=e.datasource,n=e.query,r=e.onRunQuery,a=e.onChange,o=e.selectedOptions,s=je();return se.a.createElement("div",{style:{flex:1,display:"flex"}},se.a.createElement(D.InlineFormLabel,{className:"query-keyword",width:"auto"},"Query ",se.a.createElement(D.Tooltip,{placement:"top",content:se.a.createElement("span",null,"See"," ",se.a.createElement("a",{href:"https://docs.aws.amazon.com/xray/latest/devguide/xray-console-filters.html?icmpid=docs_xray_console",target:"_blank",rel:"noreferrer",className:s.tooltipLink},"X-Ray documentation")," ","for filter expression help."),theme:"info"},se.a.createElement(D.Icon,{className:"gf-form-help-icon gf-form-help-icon--right-normal",name:"info-circle",size:"sm"}))),se.a.createElement(De,{query:n,history:[],datasource:t,onRunQuery:function(){a(n),n.query&&r()},onChange:function(e){a(i(i({},n),{queryType:Ue(o.map((function(e){return e.value})),e.query),query:e.query}))}}))}var Ie,Pe,ke=Object(D.stylesFactory)((function(){return{container:Object(Ae.css)(Ie||(Ie=f(["\n    display: flex;\n  "],["\n    display: flex;\n  "]))),link:Object(Ae.css)(Pe||(Pe=f(["\n    white-space: nowrap;\n  "],["\n    white-space: nowrap;\n  "])))}}));function Me(e){var t=e.datasource,n=e.query,r=e.range,a=ke();return se.a.createElement("div",{className:a.container},[["To X-Ray service map",t.getServiceMapUrl(n.region)],["Open in X-Ray console",t.getXrayUrlForQuery(n,r)]].map((function(e){var t=c(e,2),n=t[0],r=t[1];return se.a.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",key:r},se.a.createElement("span",{className:"gf-form-label gf-form-label--btn "+a.link},se.a.createElement("i",{className:"fa fa-share-square-o"})," ",n))})))}function Ge(e){return e&&e!==O.getTimeSeriesServiceStatistics?e===O.getTrace||e===O.getTraceSummaries?[be]:e===O.getInsights?[Ee]:function e(t,n){var r,a;void 0===n&&(n=_e);try{for(var o=u(n),i=o.next();!i.done;i=o.next()){var s=i.value,l=[];if(s.queryType===t)return l.push(s),l;if(s.children){var c=e(t,s.children);if(c.length)return l.push.apply(l,d([s],c)),l}}}catch(e){r={error:e}}finally{try{i&&!i.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return[]}(e):[Se]}function Ue(e,t){var n,r,a;if(e[0]===be.value)return/^\d-\w{8}-\w{24}$/.test(t.trim())?O.getTrace:O.getTraceSummaries;var o=void 0,i=function(e){o=(null!==(a=null==o?void 0:o.children)&&void 0!==a?a:_e).find((function(t){return t.value===e}))};try{for(var s=u(e),l=s.next();!l.done;l=s.next()){i(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o.queryType}var Ve,Le,Ke,Xe=Object(D.stylesFactory)((function(){return{queryParamsRow:Object(Ae.css)(Ve||(Ve=f(["\n    flex-wrap: wrap;\n  "],["\n    flex-wrap: wrap;\n  "]))),spring:Object(Ae.css)(Le||(Le=f(["\n    flex: 1;\n  "],["\n    flex: 1;\n  "]))),regionSelect:Object(Ae.css)(Ke||(Ke=f(["\n    margin-right: 4px;\n  "],["\n    margin-right: 4px;\n  "])))}}));function Be(e){var t,n,r=e.query,a=e.onChange,o=e.datasource,s=e.onRunQuery,l=e.groups,u=e.range,c=e.regions,f=Ge(r.queryType),p=d([{label:"default",value:"default",text:"default"}],c);xe(r,a,l,p,o);var m=f[0]===Ee?d([Ne],l):l,y=Xe();return se.a.createElement("div",null,![Ee,we].includes(f[0])&&se.a.createElement("div",{className:"gf-form"},se.a.createElement(qe,{query:r,datasource:o,onChange:a,onRunQuery:s,selectedOptions:f})),se.a.createElement("div",{className:"gf-form "+y.queryParamsRow},se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"query-keyword",width:"auto"},"Region"),se.a.createElement(D.Select,{className:y.regionSelect,options:p,value:r.region,onChange:function(e){return a(i(i({},r),{region:e.value}))},width:18,placeholder:"Choose Region",menuPlacement:"bottom",maxMenuHeight:500})),se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"query-keyword",width:"auto"},"Query Type"),se.a.createElement(D.ButtonCascader,{value:f.map((function(e){return e.value})),options:_e,onChange:function(e){var t=Ue(e,r.query||"");a(i(i({},r),{queryType:t,columns:t===O.getTimeSeriesServiceStatistics?["all"]:void 0}))}},f[f.length-1].label)),se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"query-keyword",width:"auto"},"Group"),se.a.createElement(D.Segment,{value:null===(t=r.group)||void 0===t?void 0:t.GroupName,options:m.map((function(e){return{value:e.GroupARN,label:e.GroupName}})),onChange:function(e){a(i(i({},r),{group:m.find((function(t){return t.GroupARN===e.value}))}))}})),se.a.createElement("div",{className:"gf-form"},f[0]===Ee&&se.a.createElement("div",{className:"gf-form"},se.a.createElement(D.InlineFormLabel,{className:"query-keyword",width:"auto"},"State"),se.a.createElement(D.Segment,{value:null!==(n=r.state)&&void 0!==n?n:"All",options:["All","Active","Closed"].map((function(e){return{value:e,label:e}})),onChange:function(e){a(i(i({},r),{state:e.value}))}}))),se.a.createElement("div",{className:"gf-form"},f[0]===Se&&se.a.createElement("div",{className:"gf-form","data-testid":"resolution",style:{flexWrap:"wrap"}},se.a.createElement(D.InlineFormLabel,{className:"query-keyword",width:"auto"},"Resolution"),se.a.createElement(D.Segment,{value:r.resolution?r.resolution.toString()+"s":"auto",options:["auto","60s","300s"].map((function(e){return{value:e,label:e}})),onChange:function(e){var t=e.value;a(i(i({},r),{resolution:"auto"===t?void 0:parseInt(t,10)}))}}))),se.a.createElement("div",{className:y.spring}),se.a.createElement(Me,{datasource:o,query:r,range:u})),f[0]===Se&&se.a.createElement("div",{className:"gf-form","data-testid":"column-filter",style:{flexWrap:"wrap"}},se.a.createElement(D.InlineFormLabel,{className:"query-keyword",width:"auto"},"Columns"),se.a.createElement("div",{style:{flex:1}},se.a.createElement(D.MultiSelect,{allowCustomValue:!1,options:Object.keys(Te).map((function(e){return{label:Te[e],value:e}})),value:(r.columns||[]).map((function(e){return{label:Te[e],value:e}})),onChange:function(e){return a(i(i({},r),{columns:e.map((function(e){return e.value}))}))},closeMenuOnSelect:!1,isClearable:!0,placeholder:"All columns",menuPlacement:"bottom"}))))}var He,Je=["ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","cn-north-1","cn-northwest-1","eu-central-1","eu-north-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-iso-east-1","us-isob-east-1","us-west-1","us-west-2"].map((function(e){return{label:e,value:e,text:e}}));function Qe(e,t){return se.a.createElement("div",{className:"cheat-sheet-item__example",key:e,onClick:function(){return t({refId:"A",query:e,queryType:O.getTraceSummaries})}},se.a.createElement("code",null,e))}n.d(t,"plugin",(function(){return We}));var We=new r.DataSourcePlugin(re).setConfigEditor(pe).setQueryEditorHelp((function(e){var t=e.onClickExample;return se.a.createElement("div",null,se.a.createElement("h2",null,"X-Ray Cheat Sheet"),se.a.createElement("div",{className:"cheat-sheet-item"},se.a.createElement("p",null,se.a.createElement("span",null,"Use the search bar to display traces for a service, trace ID, or filter expression."),se.a.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://docs.aws.amazon.com/console/xray/xray-filter-expressions"},"Learn more")),se.a.createElement("div",{className:"cheat-sheet-item__title"},"Filter expressions"),se.a.createElement("div",null,"You can use custom expressions to narrow down your search."),se.a.createElement("div",null,"Traces where response time was more than 5 seconds:"),Qe("responsetime > 5",t),se.a.createElement("div",null,"Traces where the total duration was 5 to 8 seconds:"),se.a.createElement("div",null,Qe("duration > 5 AND duration < 8",t)),se.a.createElement("div",null,"Traces that included a call to 'api.example.com' with a fault (500 series error) or response time above 2.5 seconds, and with one or more segments having an annotation named 'account' with value '12345':"),se.a.createElement("div",null,Qe('service("api.example.com") AND annotation.account = "12345"',t)),se.a.createElement("div",null,"Traces where the service 'api.example.com' made a call to 'backend.example.com' that failed with a fault:"),se.a.createElement("div",null,Qe('edge("api.example.com", "backend.example.com")',t)),se.a.createElement("div",null,"Traces where the URL begins with 'http://api.example.com/' and contains '/v2/' but does not reach a service named 'api.example.com':"),se.a.createElement("div",null,Qe('http.url BEGINSWITH "http://api.example.com/" AND http.url CONTAINS "/v2/" AND !service("api.example.com")',t)),se.a.createElement("div",null,"Traces that completed successfully in under 3 seconds, including all downstream calls:"),se.a.createElement("div",null,Qe("ok !partial duration < 3",t)),se.a.createElement("div",null,"If you have multiple services with the same name but different types, you can use an ID function to distinguish between them in a service or edge filter expression:"),se.a.createElement("div",null,Qe('service(id(name: "api.example.com", type: "AWS::EC2::Instance"))',t)),se.a.createElement("div",{className:"cheat-sheet-item"},se.a.createElement("div",{className:"cheat-sheet-item__title"},"Filter keywords"),se.a.createElement("table",{className:Object(Ae.css)(He||(He=f(["\n              td {\n                padding: 5px 10px 5px 10px;\n              }\n            "],["\n              td {\n                padding: 5px 10px 5px 10px;\n              }\n            "])))},se.a.createElement("thead",null,se.a.createElement("tr",null,se.a.createElement("th",null,"Attribute"),se.a.createElement("th",null,"Type"),se.a.createElement("th",null,"Description"))),se.a.createElement("tbody",null,se.a.createElement("tr",null,se.a.createElement("td",null,"ok"),se.a.createElement("td",null,"Boolean"),se.a.createElement("td",null,"Response status code was 2XX Success.")),se.a.createElement("tr",null,se.a.createElement("td",null,"error"),se.a.createElement("td",null,"Boolean"),se.a.createElement("td",null,"Response status code was 4XX Client Error.")),se.a.createElement("tr",null,se.a.createElement("td",null,"fault"),se.a.createElement("td",null,"Boolean"),se.a.createElement("td",null,"Response status code was 5XX Server Error.")),se.a.createElement("tr",null,se.a.createElement("td",null,"partial"),se.a.createElement("td",null,"Boolean"),se.a.createElement("td",null,"Request has incomplete segments.")),se.a.createElement("tr",null,se.a.createElement("td",null,"responsetime"),se.a.createElement("td",null,"Number"),se.a.createElement("td",null,"Time that the server took to send a response.")),se.a.createElement("tr",null,se.a.createElement("td",null,"duration"),se.a.createElement("td",null,"Number"),se.a.createElement("td",null,"Total request duration including all downstream calls.")),se.a.createElement("tr",null,se.a.createElement("td",null,"http.status"),se.a.createElement("td",null,"Number"),se.a.createElement("td",null,"Response status code.")),se.a.createElement("tr",null,se.a.createElement("td",null,"http.url"),se.a.createElement("td",null,"String"),se.a.createElement("td",null,"Request URL.")),se.a.createElement("tr",null,se.a.createElement("td",null,"http.method"),se.a.createElement("td",null,"String"),se.a.createElement("td",null,"Request method.")),se.a.createElement("tr",null,se.a.createElement("td",null,"http.useragent"),se.a.createElement("td",null,"String"),se.a.createElement("td",null,"Request user agent string.")),se.a.createElement("tr",null,se.a.createElement("td",null,"http.clientip"),se.a.createElement("td",null,"String"),se.a.createElement("td",null,"Requestor's IP address.")),se.a.createElement("tr",null,se.a.createElement("td",null,"user"),se.a.createElement("td",null,"String"),se.a.createElement("td",null,"Value of user field on any segment in the trace.")),se.a.createElement("tr",null,se.a.createElement("td",null,"annotation.*key*"),se.a.createElement("td",null,"String"),se.a.createElement("td",null,"Value of annotation with field *key*.")),se.a.createElement("tr",null,se.a.createElement("td",null,"service(*name*) "),se.a.createElement("td",null,"Complex"),se.a.createElement("td",null,"Service with name *name*. Optional curly braces can contain a filter expression that applies to segments created by the service.")),se.a.createElement("tr",null,se.a.createElement("td",null,"edge(*source*, *destination*) "),se.a.createElement("td",null,"Complex"),se.a.createElement("td",null,"Connection between services *source* and *destination*. Optional curly braces can contain a filter expression that applies to segments on this connection.")))))))})).setQueryEditor((function(e){var t=function(e){var t=this,n=ye()((function(){return s(t,void 0,void 0,(function(){return l(this,(function(t){return[2,e.getRegions()]}))}))}),[e]);return ge("Failed to load regions from AWS, showing default regions instead.",n.error),n.error?Je:n.loading?void 0:n.value}(e.datasource),n=function(e,t){var n=this,r=ye()((function(){return s(n,void 0,void 0,(function(){return l(this,(function(n){return[2,e.getGroups(t)]}))}))}),[e,t]);return ge("Failed to load groups",r.error),r.error?[{GroupARN:"default",GroupName:"Default"}]:r.value}(e.datasource,e.query.region);return n&&t?se.a.createElement(Be,i({},i(i({},e),{groups:n,regions:t}))):se.a.createElement(D.Spinner,null)}))}])}));
//# sourceMappingURL=module.js.map